# .tmux.conf — tmux configuration
# Part of ~/dotfiles

# ══════════════════════════════════════════
# Prefix
# ══════════════════════════════════════════
# Remap prefix from Ctrl+b to Ctrl+a (easier to reach)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ══════════════════════════════════════════
# General
# ══════════════════════════════════════════
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -g history-limit 50000
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
setw -g automatic-rename on
set -g set-titles on
set -g set-titles-string "#S / #W"
set -g escape-time 0
set -g focus-events on
set -g display-time 2000
set -g display-panes-time 2000

# ══════════════════════════════════════════
# Key bindings
# ══════════════════════════════════════════
# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# Intuitive splits (open in current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-style pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick window switching
bind -r p previous-window
bind -r n next-window
bind Tab last-window

# Session management
bind S command-prompt -p "New session:" "new-session -s '%%'"
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# Search scrollback
bind / copy-mode \; send-key ?

# ══════════════════════════════════════════
# Copy mode (vi)
# ══════════════════════════════════════════
setw -g mode-keys vi

bind Enter copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel

# System clipboard integration
# Linux (X11)
if-shell "command -v xclip" \
    "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'"
# Linux (Wayland)
if-shell "command -v wl-copy" \
    "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'wl-copy'"
# WSL
if-shell "command -v clip.exe" \
    "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'clip.exe'"

# ══════════════════════════════════════════
# Status bar
# ══════════════════════════════════════════
set -g status on
set -g status-interval 5
set -g status-position bottom
set -g status-justify left

# Colors
set -g status-style "bg=colour235,fg=colour248"
set -g message-style "bg=colour235,fg=colour166"
set -g pane-border-style "fg=colour238"
set -g pane-active-border-style "fg=colour166"

# Left: session name
set -g status-left-length 30
set -g status-left "#[fg=colour232,bg=colour166,bold] #S #[fg=colour166,bg=colour235] "

# Window list
setw -g window-status-format " #I:#W "
setw -g window-status-current-format "#[fg=colour166,bold] #I:#W* "
setw -g window-status-separator "|"

# Right: user@host, date, time
set -g status-right-length 60
set -g status-right "#[fg=colour248] #(whoami)@#H | %Y-%m-%d %H:%M "
